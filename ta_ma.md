# MA

移动平均线，可分为简单移动平均线 SMA 和 指数移动平均线 EMA，假设收盘价 `close = {p1，p2，...，pn}`，n 日的移动平均线计算公式如下

$$
sma_i = \frac{p_{i-n+1} + p_{i-n+2} + ... + p_{i}}{n}
$$

$$
ema_i = \frac{2}{n+1} \times p_i + \frac{n-1}{n+1} \times ema_{i-1}
$$

代码实现如下

```python
import pandas as pd

def calc_sma(series, window) -> pd.Series:
    """
    计算简单移动平均线 MA
    """
    ma = series.rolling(window=window).mean()
    ma.name = f'MA{window}'

    return ma

def calc_expma(close, n):
    """
    计算指数移动平均线 EXPMA
    """
    expma = []
    for ele in close.array:
        if len(expma) == 0:
            expma.append(ele)
            continue

        prev_expma = expma[-1]
        alpha = 2 / (n+1)
        cur_expma = alpha * ele + (1-alpha) * prev_expma

        expma.append(cur_expma)

    expma = pd.Series(expma, name=f'EXPMA{n}')
    return expma
```

## 研究

> 来自：沪深 A 股市场中趋势投资有效性研究——基于移动平均线策略,王晨阳(三峡大学),商业经济,10.19905/j.cnki.syjj1982.2019.09.066
>
> 该作者的基本观点是 短期 MA 上穿 长期 MA 时 产生买入信号，而 短期 MA 下穿 长期 MA 时产生卖出信号. 其添加了 `X` 百分比来调整触发的位置. 但令人沮丧的是，实验的参数并没有完全写出来(`X`未提及)。另外，选取的三组参数也没有进一步的横向对比。不够严谨，论证也不够充分，参考价值有限。

产生买入或保持多头头寸的交易信号：

$$
\frac{1}{S} \sum_{i=1}^{s} P_{t-i} > (1 + X) \times \frac{1}{L} \sum_{i=1}^{L} P_{t-i}
$$

产生卖出或保持零头寸的交易信号：

$$
\frac{1}{S} \sum_{i=1}^{s} P_{t-i} < (1 + X) \times \frac{1}{L} \sum_{i=1}^{L} P_{t-i}
$$

其中，$P_{t-i}$ 表示第 (t-i) 天的收盘价，S 表示 MA 短期期限，L 表示 MA 长期期限，X 表示百分比幅度.

作者在 沪深 300 指数和中证 500 指数上进行了实验，选取的时间为 2005 年 6 月 5 日至 2019 年 1 月 4 日，对比了采用该策略以及 _直接买入持有_ (策略 B) 所带来的收益情况. 并做了三组实验，参数分别是 `{S=1,L=10,X=?}`，`{S=10,L=30,X=?}`，`{S=21,L=28,X=?}`. 他还将时间按照 _非参数法_ (通过判定时间序列从扩张转为收缩及从收缩转为扩张时的波峰和波谷来判定) 划分了牛熊市，如下所示

| 命名         | 时间范围                                   |
| ------------ | ------------------------------------------ |
| 第一次牛市   | 2005 年 6 月 6 日 至 2007 年 10 月 16 日   |
| 第一次熊市   | 2007 年 10 月 16 日 至 2008 年 10 月 28 日 |
| 第二次牛市   | 2008 年 10 月 29 日 至 2009 年 8 月 4 日   |
| 第二次熊市   | 2009 年 8 月 5 日 至 2014 年 7 月 21 日    |
| 第三次牛市   | 2014 年 7 月 22 日 至 2015 年 6 月 12 日   |
| 第一次震荡期 | 2015 年 6 月 12 日 至 2007 年 1 月 4 日    |

实验结果表明，该策略在熊市和震荡期的收益好于 策略 B，而在牛市则不如 策略 B. 单纯看累计收益率的话，该策略优于 策略 B.
